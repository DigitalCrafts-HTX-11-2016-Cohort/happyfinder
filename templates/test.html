{% extends "layout.html" %}
{% block body %}
    <body onload="map">
    <div class="container-fluid">
        <div class="clearfix row">
            <div class="col-xs-9" id="map"></div>
            <div class="col-xs-3" id="infowindow">
                <div>
                    {% for place in place_list %}
                        <a href="javascript:google.maps.event.trigger(gmarkers['{{ place.address }}'],'mouseover');"
                           class="button3">
                            <div class="place_details">
                                <table class="place_descriptions" style="border: 1px solid dimgray; width: 100%">
                                    <tr>
                                        <th colspan="2" style="text-align: center"><a
                                                href="/details/{{ place.location_id }}"><h4
                                                class="place_descriptions">{{ place.name }}</h4></a></th>
                                    </tr>
                                    <tr>
                                        <th colspan="2" style="text-align: center; border-bottom: 3px solid dimgray"><h5
                                                class="place_descriptions">{{ place.price_level * '$' }} -
                                            Rating: {{ place.rating }}</h5></th>
                                    </tr>
                                    <tr>
                                        <td style="width: 100%">
                                            <table style="width: 100%">
                                                <tr style="display: none">
                                                    <th style="display: none"></th>
                                                </tr>
                                                <tr>
                                                    <td style="width: 100%">
                                                        {% for day in place.happy_hour %}
                                                            <table style="width: 100%; border-right:1px solid dimgray;">
                                                                <tr style="display: none">
                                                                    <th style="display: none"></th>
                                                                    <th style="display: none"></th>
                                                                </tr>
                                                                <tr>
                                                                    <td style="text-align: center; width: 50%; font-weight: bold">
                                                                        {{ day.day_string }}
                                                                    </td>
                                                                    <td style="text-align: center; width: 50%">
                                                                        {{ day.start_time.strftime("%I:%M %p") }}
                                                                        - {{ day.end_time.strftime("%I:%M %p") }}
                                                                    </td>
                                                                </tr>
                                                            </table>
                                                        {% endfor %}
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </a>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    <script>

        var im = 'http://www.robotwoods.com/dev/misc/bluecircle.png';

        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 12,
            center: new google.maps.LatLng(position.coords.latitude, position.coords.longitude),
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        var infowindow = new google.maps.InfoWindow();

        function createMarker(latlng, html) {
            var marker = new google.maps.Marker({
                position: latlng,
                map: map
            });
            google.maps.event.addListener(marker, 'mouseover', function () {
                infowindow.setContent(html);
                infowindow.open(map, marker);
            });
            return marker;
        }

        function userMarker() {
            var marker = new google.maps.Marker({
                position: userLoc,
                icon: im,
                map: map
            });
            google.maps.event.addListener(marker, 'mouseover', function () {
                infowindow.setContent("My Location");
                infowindow.open(map, marker);
            });
            return marker;
        }

        userMarker();

        latlng_list = {{ latlng_list }};

        for (var i = 0; i < latlng_list.length; i++) {
            gmarkers[latlng_list[i][3]] =
                createMarker(new google.maps.LatLng(latlng_list[i][0], latlng_list[i][1]), latlng_list[i][2] + "<br>" + latlng_list[i][3]);
        }

        google.maps.event.addDomListener(window, 'load', initialize);

        function fail() {
            alert('navigator.geolocation failed, may not be supported');
        }
    </script>
<script src="http://maps.google.com/maps/api/js?key={{ g_api_key }}&.js"></script>
{% endblock %}
